description: |
  Create an local OpenShift cluster.

usage:
  version: 2.1

  orbs:
    openshift: circleci/openshift@0.1.0

  jobs:
    deploy-to-local-cluster:
      executor: openshift/machine-for-local-cluster
      steps:
        - openshift/create-local-cluster-with-oc:
            skip-registry-check: true
        - openshift/login-and-update-kubeconfig:
            server-address: "https://127.0.0.1:8443"
            username: dev1
            password: password
            openshift-platform-version: "3.x"
            insecure-skip-tls-verify: true
        - run:
            name: Deploy an application
            command: |
              # Create a new project to hold the application
              oc new-project mytest
              # Tag an application image from a container registry into the project
              oc tag --source=docker openshift/deployment-example:v1 deployment-example:latest
              # Deploy the application image
              oc new-app deployment-example:latest
              # Display a summary of the deployed resources
              oc status
  workflows:
    deployment:
      jobs:
        - deploy-to-local-cluster
